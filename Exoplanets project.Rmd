Exploratory Data Analysis of Known Exoplanets by Luke Tibbott
========================================================




> This data set was retrieved from the NASA Exoplanet Archive. An exoplanet is an extrasolar planet -- that is, a planet that exists outside of earth's solar 
system. The original data set has been pared down to 15 columns from 200+
columns. 

> When cleaning this dataset I was confronted with the issue of what to do with
the large amount of null values in certain columns. Removing all the rows with 
nulls results in a tiny dataset, and imputing the values is very dangerous due
to the possibility of assigning incorrect values. Most null values are due to 
how a particular data point was captured -- different exoplanet discovery 
missions are simply incapable of capturing certain characteristics of an 
exoplanet. Nonetheless, any good data we can add to our dataset is valuable
to our analysis, so I decided to keep the null values.




```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report


library(tidyverse)


```

```{r echo=FALSE, Data_cleaning}
# Read in datat to a dataframe object
df <- read.csv('planets.csv', header=TRUE)

# Grab columns 2 through 20
pa <- df[, 2:20]

pa$pl_name <- df$pl_name
pa$st_optmag <- df$st_optmag
pa$st_dist <- df$st_dist
pa$st_spster <- df$st_spstr
pa$st_age <- df$st_age
pa$st_mass <- df$st_mass
pa$st_dist <- df$st_dist
pa$st_teff <- df$st_teff

# Drop columns we don't care about
ep <- pa[ , -which(names(pa) %in% c('pl_orbeccen', 'pl_orbincl', 
                                    'pl_ttvflag', 'pl_kepflag',
                                    'pl_k2flag', 'pl_nnotes',
                                    'ra', 'dec_str', 'pl_bmassprov',
                                    'ra_str'))]

```



```{r echo=FALSE, Data_transformation}

# Reorder the discovery method factor according to the count of planets
# discovered using each method, descending.
ep$pl_discmethod <- factor(ep$pl_discmethod, levels = 
                             c('Transit','Radial Velocity', 'Microlensing',
                               'Imaging', 'Transit Timing Variations',
                               'Eclipse Timing Variations', 
                               'Orbital Brightness Modulation',
                               'Pulsar Timing', 'Pulsation Timing Variations',
                               'Astrometry'))

# Change the spectral type column to only be the first letter of the string.
# This will give us a broad definition of the star's spectral type rather than
# a very specific one
ep$st_spster <- substring(ep$st_spster, 1, 1)

# Factor spectral type column to ensure ggplot plays nice with it
ep$st_spster %>% factor(levels = c('A', 'B', 'F', 'G', 'K', 'L', 'M', 'S',
                                   'T', 'W'))

# Here we essentially exclude all planets that are not the "final" planet in
# their system, and use this dataframe to keep track of the number of planets
# in each system
num_planets = subset(ep, (ep$pl_letter == 'b' & ep$pl_pnum == 1) |
                       (ep$pl_letter == 'c' & ep$pl_pnum == 2) |
                       (ep$pl_letter == 'd' & ep$pl_pnum == 3) |
                       (ep$pl_letter == 'e' & ep$pl_pnum == 4) |
                       (ep$pl_letter == 'f' & ep$pl_pnum == 5) |
                       (ep$pl_letter == 'g' & ep$pl_pnum == 6) |
                       (ep$pl_letter == 'h' & ep$pl_pnum == 7) | 
                       (ep$pl_letter == 'i' & ep$pl_pnum == 8))


```



```{r echo=FALSE, Functions}
#' Produces a histogram plot using ggplot2.
#' Arguments: df, a dataframe object; x, a variable in df;
#' binwidth, width of the bars in the histogram

hist_plot <- function(df, x, binwidth) {
  ggplot(df, aes(x = x)) + geom_histogram(binwidth=binwidth)
}

```





```{r echo=FALSE, Summarize_dataframe}
summary(ep)
```

```{r echo=FALSE, structure_of_dataframe}
str(ep)
```



# Univariate Plots Section

> **Tip**: In this section, you should perform some preliminary exploration of
your dataset. Run some summaries of the data and create univariate plots to
understand the structure of the individual variables in your dataset. Don't
forget to add a comment after each plot or closely-related group of plots!
There should be multiple code chunks and text sections; the first one below is
just to help you get started.

```{r echo=FALSE, Univariate_Plots}
ggplot(ep, aes(x = pl_discmethod)) + geom_bar() + 
  theme(axis.text.x =  element_text(angle = 70, size = 8, hjust = 1)) +
  scale_y_sqrt()
```

> This bar chart shows us that transit and radial velocity methods of discovery
are far and way the most popular methods for discovering exoplanets.
Each of the other methods account for a very small proportion of all discovered
exoplanets.

A couple notes and questions regarding the 'discovery method' variable analyzed
in this project:

* The transit method relies on an exoplanet passing between Earth and a host
 star. The exoplanet blocks some of the star's electromagnetic (EM) energy, thus 
 confirming its existence. Perhaps a planet with a larger radius would block 
 more EM energy and make it easier to discover?
 
* The radial velocity method looks at small changes in a star's motion (eg
whether the star is moving towards earth or away from Earth) to infer the
existence of a planet. I wonder if more massive planets affect the motion of 
stars more, making it easier to discover more massive planets with this method?

* Microlensing relies on a magnification effect from a massive and very distant
 object to allow the observation of objects that don't emit much electromagnetic
 energy, like a planet. What planetary attribute would lend itself to more 
 planets being discovered this way?
 
* Imaging relies on us being able to directly see a planet. Perhaps planets 
 are very close are discovered using imaging more frequently.
 
* The six other methods of discovering planets will not be explored in this
 analysis.


```{r echo=FALSE, Univariate_Plots}
```


```{r echo=FALSE, planet_mass}

hist_plot(ep, ep$pl_bmassj, .5)

```

> These plots show us that a large number of the planets are very close to
0 Jupiter masses (although none of them are exactly 0). This would lead me to
believe these planets are not gas giants with huge mass and huge radius, but
perhaps small, rocky planets. I would guess the planets with higher mass are gas
giants. We can take a look at planet radius later on to see if these planets'
radii match up with the large numbers we'd expect from gas giants.


```{r}

hist_plot(ep, ep$pl_bmassj, .5) + coord_cartesian(xlim = c(0, 30)) +
scale_y_log10() + xlab('Jupiter Masses')


```

> The log-10 adjusted graph gives us a better idea of how planetary mass
is distributed near 0 Jupiter masses. Again, we see a heavily right skewed
distribution. 

```{r}

hist_plot(ep, ep$pl_radj, .1) + xlab('Jupiter Radii')

```

> Most of the planets are less than .25 Jupiter radii, but there is a small
peak a little over 1 Jupiter radius. I expected the planets' radii to be be much
higher after seeing the mass plot. This makes me think that many of the planets
have a high density.

```{r}

hist_plot(ep, ep$pl_dens, 1) + xlab('Density, g / cm**3')

```

> As suspected, we do see a bit more variance in density, but the relationship
between mass, radius, and density need to be investigated more.

```{r}

trans <- ep %>% subset(pl_discmethod == 'Transit')
rv <- ep %>% subset(pl_discmethod == 'Radial Velocity')
ml <- ep %>% subset(pl_discmethod == 'Microlensing')
im <- ep %>% subset(pl_discmethod == 'Imaging')

```


```{r}

hist_plot(trans, trans$pl_bmassj, .3) + xlab('Jupiter Masses')

```

> The mass of planets discovered via the transit method is heavily concentrated
below 2.5 Jupiter masses, with relatively low variance.

```{r}

hist_plot(rv, rv$pl_bmassj, .3) + xlab('Jupiter Masses')

```

> Planets discovered via the radial velocity method have a distribution very
similar to those discovered via transit.

```{r}

hist_plot(ml, ml$pl_bmassj, .1) + xlab('Jupiter Masses')

```

> We have very few data points for planets discovered via microlensing, but 
this distribution has much higher variance. Most planets discovered via
microlensing have relatively low mass, but a significant proportion of planets
discovered via microlensing have more than 2.5 Jupiter masses.

```{r}

hist_plot(im, im$pl_bmassj, .3) + xlab('Jupiter Masses')

```

> We have even less data for planets discovered via imaging, but this 
distribution is the only one we've seen that isn't clustered near 0 Jupiter 
masses. I would guess that it's easier to discover more massive planets via 
imaging because they are bigger and easier to see. Let's take a look at
the radius of planets discovered via imaging to confirm that they are bigger:

```{r}
hist_plot(im, im$pl_radj, .1) + xlab('Jupiter Radii')
```

> These radii aren't as big as I expected, but let's take a look at the Radial
Velocity and Transit radii to see how they compare:

```{r}
hist_plot(rv, rv$pl_radj, .1) + xlab('Jupiter Radii')
```


```{r}

hist_plot(trans, trans$pl_radj, .1) + xlab('Jupiter Radii')

```

> The radii of planets discovered via transit or radial velocity are generally
below 2 Jupiter radii, whereas the planets discovered via imaging have multiple
data points greater than 3 radii.

```{r echo=FALSE, num_planets}
summary(num_planets)
ggplot(num_planets, aes(x = factor(pl_pnum))) + geom_bar()


```

> Most planetary systems we've discovered have 
only one planet. I'm interested to see if certain discovery methods lend
themselves to discovering systems with more or less planets in them.

```{r}

hist_plot(ep, ep$st_age, .1) + xlab('Star age (billions of years)')

```



> The distribution of parent stars is certainly unimodal although perhaps not
quite normal, with a clear peak a bit older than 4 billion years old, and a
higher concentration of stars between 0 and 4.5 billion years old than stars 
between 4.5 and 12 billion years old. This could indicate a number of things,
including our current detection methods being biased towards finding planets
orbiting younger stars, or perhaps younger stars are more likely to host
planets.

> A five-number summary of star age shows us the median and mean are both just
over 4 billion years, the interquartile range is 3 to 4.725 billion years. The 
minimum is .001 billion years and the max is 12.5 billion years. This means
we have discovered planets orbiting both extremely young and extremely old
stars, but most are orbiting stars whose age lies somewhere in between. 

```{r}

hist_plot(ep, ep$st_mass, 1)

```


```{r}

hist_plot(ep, ep$st_mass, .1) + coord_cartesian(xlim = c(0, 5))

```
> The stars in our dataset form an almost normal distribution around 1 solar
mass, with very slight skew to the right. 

```{r}

ggplot(subset(ep, ep$st_spster != ''), aes(x = st_spster)) +
  geom_bar()

```
> Most stars with exoplanets orbiting them can be lumped in to one of four
stellar classifications: F, G, K, or M.

> Interestingly, the most common stellar
classification is G, which is the same classification as our own sun.

> Class M stars are the most common stars in the universe, so it is not
surprising that many stars in our dataset are class M -- although it is
worth noting that despite class M stars prevalence in the universe, they are not
the most common stars that host exoplanets (that we've discovered). 

> Class K stars are an intermediary class between G and M stars.

> Class F stars are similar in mass to the Sun, but emit more UV radiation. 

> **Tip**: Make sure that you leave a blank line between the start / end of
each code block and the end / start of your Markdown text so that it is
formatted nicely in the knitted text. Note as well that text on consecutive
lines is treated as a single space. Make sure you have a blank line between
your paragraphs so that they too are formatted for easy readability.

# Univariate Analysis

> **Tip**: Now that you've completed your univariate explorations, it's time to
reflect on and summarize what you've found. Use the questions below to help you
gather your observations and add your own if you have other thoughts!

### What is the structure of your dataset?

There are 3735 observations and 16 variables in this dataset. Not all variables
have 3735 observations -- there are many nulls. Regardless, there are 3735 
planets represented here. 

Over 75% of them were discovered via the Transit method. Most planets are part
of a one planet system. Most planets have between 1 and 2 Jupiter masses, and 
between 0 and .5 Jupiter radii. 

Most stars these planets orbit are less than 1000 light years away. Most host
stars weigh the same or less than the sun and are less than 5 billion years old. 
In fact, most of the host stars are between 4 and 5 billion years old.

### What is/are the main feature(s) of interest in your dataset?
Discovery method is one of the focal points of this dataset. The Transit 
discovery method seems to have been the most fruitful exoplanet discovery
method, which means it's important to do some analysis of this discovery
method. Are there certain planets that this method of discovery is biased
toward discovering? If so, what are the features of those planets? 

It's also possible that this method of discovery is *not* biased, but is simply
discovering a sample distribution of planets representative of *all* planets
that exist in the universe, although this notion might be beyond the scope of 
our analysis.

### What other features in the dataset do you think will help support your \
### investigation into your feature(s) of interest?

The various attributes of the stars in the dataset will help investigate the 
discovery methods. It's possible that certain star types are predisposed to 
certain discovery methods.

Planetary attributes such as mass, density, and radius will give us a good idea
of the types of planets each discovery method is more inclined to discover. 
These attributes can also be compared to attributes of stars to see any 
relationship that might exist there.

### Did you create any new variables from existing variables in the dataset?
I created a new dataframe which tracks the number of planets in a system. A 
histogram of the column pl_pnum is not representative of the number of planets
in a system because every planet in a system of say 5 planets would have 5 
listed as the number of planets in a system. This would mean that a system of
5 planets would add 25 to the histogram plat, rather than just 5.

### Of the features you investigated, were there any unusual distributions? 
### Did you perform any operations on the data to tidy, adjust, or change the
### form of the data? If so, why did you do this?
I'm surprised by the number of 'big' planets in general! Although histograms 
show a lot of data points near zero, there are still a huge number of data
points above 1 Jupiter mass. Jupiter is the *largest* planet in our solar
system, which makes it so surprising to see such a large number of planets above
1 Jupiter mass. This makes me think that large planets are generally easier to
discover than smaller planets.


# Bivariate Plots Section

> **Tip**: Based on what you saw in the univariate plots, what relationships
between variables might be interesting to look at in this section? Don't limit
yourself to relationships between a main output feature and one of the
supporting variables. Try to look at relationships between supporting variables
as well.

```{r echo=FALSE, Bivariate_Plots}

ggplot(subset(ep, ep$pl_dens <= 60), aes(x = pl_dens, y = pl_bmassj)) + 
  geom_point()

```

> The line of points hugging 0 mass with density between 0 and 15 g/cm^3 is 
most likely representing terrestrial planets. These planets would have high
density due to their rocky composition, but low mass due to size limits (a 
terrestrial planet has a theoretical size limit of about 2 *Earth* radii
according to Wikipedia). 

```{r}

ggplot(ep, aes(x = pl_radj, y = pl_bmassj)) + geom_point()

```


```{r}

ggplot(ep, aes(x = st_dist, y = pl_bmassj)) + geom_point()

```

> There appears to be a weak negative correlation between star distance and 
planet mass. This is somewhat counterintuitive because I would expect higher
mass planets to be easier to discover than low mass planets particularly
when the host star is far away.

```{r}

ggplot(ep, aes(x = st_dist, y = pl_bmassj)) + geom_point()

```


```{r}

ggplot(subset(ep, ep$st_spster == 'F' | ep$st_spster == 'G' |
                ep$st_spster == 'K' | ep$st_spster == 'M'), 
              aes(x = st_spster, y = st_dist)) + geom_boxplot() + 
  coord_cartesian(ylim = c(0, 1000))

```

> All stars with planets around them have an interquartile range near 0 with
respect to distance from Earth. It seems that more planets have been discovered
orbiting stars near Earth than far from Earth across the four most common
star classifications in our dataset. All stellar classifications have a third 
quartile at or less than 250 light years.

```{r}

names(ep)

ggplot(ep, aes(x = st_mass, y = pl_bmassj)) + geom_point() +
  coord_cartesian(xlim = c(0, 15), ylim = c(0, 30))

```


# Bivariate Analysis

> **Tip**: As before, summarize what you found in your bivariate explorations
here. Use the questions below to guide your discussion.



### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

> The relationship between planetary mass and planetary radius, as well as
between planetary mass and planetary density is not as positievly correlated as expected. One would expect a strong correlation in both scenarios, but there is
something going on in mass, radius, and density preventing this. It definitely
warrants further investigation. Adding additional variables might definitively
explain this.

> There's a weak negative correlation between star distance from earth and 
planetary mass. I'd expect this to be explained by bias in different discovery methods. Perhaps the methods that are capable of discovering planets very far
from earth are biased towards discovering lower mass planets.

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

### What was the strongest relationship you found?


# Multivariate Plots Section

> **Tip**: Now it's time to put everything together. Based on what you found in
the bivariate plots section, create a few multivariate plots to investigate
more complex interactions between variables. Make sure that the plots that you
create here are justified by the plots you explored in the previous section. If
you plan on creating any mathematical models, this is the section where you
will do that.

```{r echo=FALSE, Multivariate_Plots}

```

```{r}

ggplot(ep, aes(x = st_dist, y = pl_bmassj, color = pl_discmethod)) +
  geom_point(alpha = 0.2) + scale_color_brewer(type='qual', palette = 2)

```
> This plot has some fascinating qualities! Almost every single planet 
discovered more than 3000 light years away was discovered through microlensing!
Radial velocity seems to be the most common discovery method for relatively 
close planets (and seems to have no problem discovering high mass planets), 
while the transit method seems to easily discover planets a little further away,
but less than 2000 light years away. Planets discovered via transit also seem to
have lower mass than planets discovered via radial velocity. Planets discovered
via imaging are generally very near earth, and can have relatively high mass.

# Multivariate Analysis



### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the \
strengths and limitations of your model.

------

# Final Plots and Summary

> **Tip**: You've done a lot of exploration and have built up an understanding
of the structure of and relationships between the variables in your dataset.
Here, you will select three plots from all of your previous exploration to
present here as a summary of some of your most interesting findings. Make sure
that you have refined your selected plots for good titling, axis labels (with
units), and good aesthetic choices (e.g. color, transparency). After each plot,
make sure you justify why you chose each plot by describing what it shows.

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

> **Tip**: Here's the final step! Reflect on the exploration you performed and
the insights you found. What were some of the struggles that you went through?
What went well? What was surprising? Make sure you include an insight into
future work that could be done with the dataset.

> **Tip**: Don't forget to remove this, and the other **Tip** sections before
saving your final work and knitting the final report!